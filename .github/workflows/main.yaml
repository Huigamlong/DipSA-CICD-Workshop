name: MyCA

#trigger
on:
  push:
    branches: 
    - "v[0-9]+.[0-9]"
 
  

# jobs
jobs: 
  #job name
  my-workflow-workshop:
    #OS that this workflow will be runnning on
    runs-on: ubuntu-latest
      

    #list of steps to perform task
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Use Node 16
      uses: actions/setup-node@v1
      with:
        node-version: 12.x

    - name: Install Railway
      run: npm i -g @railway/cli

    - name: Deploy
      run: railway up
      env:
        RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }} 
        
    - name: echo current branch
      run: echo "$(date) Current branch is ${{ github.ref_name}}"
    - name: Checkout correct branch
      uses: actions/checkout@v3
      with:
        ref: ${{github.ref_name}}
    - name: Testing
      run: echo ${{secrets.TESTING}}
    - name: Slack Notification
      id: slack
      uses: slackapi/slack-github-action@v1.23.0
      with: 
        channel: '#test-submission'
        payload: |
          {
          
          "blocks": [
            {
              "type": "header",
              "text":{
                "type": "plain_text",
                "text": "DipSA55 CI/CD Assignment Submission",
                "emoji": true
              }
            }
            {
              "type": "section",
              "fields": [
                {
                  "type": "mrkdwn",
                  "text": "*Name:*\nXUJINLONG"
                },
                {
                  "type":"mrkdwn",
                  "text": "*Metriculation:*\nA0265066B"
                }
              ]
            },
            {
            "type": "section",
            "field": [
              {
                "type": "mrkdwn",
                "text": "*Email:*\n<E1045741@u.nus.edu|E1045741@u.nus.edu>*"
              },
              {
                "type": "mrkdwn",
                "text": "*Repostory:*\n<https://github.com/Huigamlong/DipSA-CICD-Workshop|https://github.com/Huigamlong/DipSA-CICD-Workshop>"
              }
            ]
            },
            {
            "type": "section",
            "field": [
              {
                "type": "mrkdwn",
                "text": "*Deployment:*\n<https://hushed-coal-production.up.railway.app>"
              }
            ]
            },
            {
            "type": "section"
            "field":[
              {
                "type": "mrkdwn",
                "text":<https://hushed-coal-production.up.railway.app|Open Application>
              }
            ]
            }
            
          ]
          }
          
      env: 
        SLACK_WEBHOOK_URL: ${{secrets.SLACK_WEBHOOK_URL}}
        SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
        SLACK_CHANNEL: general
        SLACK_COLOR: '#3278BD'
        SLACK_MESSAGE: 'Post Content :rocket:'
        SLACK_TITLE: Post Title
        SLACK_USERNAME: rtCamp